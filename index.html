<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒªãƒˆãƒªãƒ¼ãƒˆå…¥å£ãƒŠãƒ“ï¼ˆver.1ï¼‰</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --mi-color: #ff7f7f;
            --to-color: #4db8ff;
            --bg-color: #fcf9f5; --text: #4a4a4a;
        }
        body { font-family: 'Zen Maru Gothic', sans-serif; background-color: var(--bg-color); color: var(--text); margin: 0; padding: 15px; line-height: 1.8; }
        .container { max-width: 650px; width: 100%; margin: 20px auto; background: white; padding: 25px; border-radius: 30px; box-shadow: 0 15px 35px rgba(220, 180, 150, 0.15); border: 1px solid rgba(0,0,0,0.03); box-sizing: border-box;}
        .header h1 { font-size: 1.8rem; color: #d48344; margin: 10px 0; text-align: center; }
        
        .no-box { background: #fff5eb; border: 1px solid #f9e2c4; padding: 15px; border-radius: 15px; margin-bottom: 15px; text-align: center; }
        .intro-box { background: #fdfdfd; border: 1px solid #eee; padding: 20px; border-radius: 20px; margin-bottom: 25px; font-size: 0.9rem; line-height: 1.6; }

        .tab-menu { display: flex; gap: 8px; margin: 20px 0; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn { flex: 1; min-width: 120px; padding: 12px 5px; border: none; border-radius: 16px; cursor: pointer; font-weight: bold; background: #f0f0f0; transition: all 0.2s ease; font-family: inherit; font-size: 0.85rem; color: #999; }
        .tab-btn.active { color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .tab-btn[data-tab="mi"].active { background: var(--mi-color); }
        .tab-btn[data-tab="total"].active { background: var(--to-color); }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .q-block { margin-bottom: 20px; padding: 20px; border-radius: 20px; background: #fff; border: 1px solid #f0f0f0; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .q-text { font-weight: bold; font-size: 1rem; margin-bottom: 18px; display: block; color: #333; line-height: 1.5; }
        .radio-group { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .radio-label { text-align: center; font-size: 0.65rem; cursor: pointer; padding: 8px 4px; border-radius: 12px; border: 1px solid #eee; background: #fafafa; }
        .radio-label input { width: 20px; height: 20px; margin-bottom: 5px; }
        
        .btn { width: 100%; padding: 18px; color: white; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 15px; box-shadow: 0 6px 15px rgba(0,0,0,0.1); text-decoration: none; display: inline-block; text-align: center; box-sizing: border-box; }
        
        .res-area { margin-top: 25px; padding: 25px; border-radius: 25px; display: none; background: #fff; border-top: 8px solid; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .res-area h3 { color: #333; margin-top: 0; }
        
        .analysis-card { background: #fdfdfd; padding: 20px; border-radius: 20px; border: 1px solid #f0f0f0; margin-bottom: 15px; }
        .analysis-label { font-weight: bold; color: #d48344; margin-bottom: 5px; display: block; font-size: 0.9rem; }
        .analysis-text { font-size: 0.95rem; line-height: 1.7; margin-bottom: 15px; display: block; }

        #capture-container { 
            width: 1200px; 
            background: #fcf9f5; position: absolute; left: -9999px; 
            padding: 50px; box-sizing: border-box; display: flex; flex-direction: column; gap: 30px;
        }
        .cap-row { display: flex; gap: 30px; align-items: stretch; }
        .cap-col { flex: 1; display: flex; flex-direction: column; gap: 30px; }
        .cap-box { border: 2px solid #eee; border-radius: 35px; padding: 35px; background: white; box-shadow: 0 10px 20px rgba(0,0,0,0.02); }
        .cap-title { font-size: 28px; font-weight: bold; margin-bottom: 20px; color: #d48344; border-bottom: 4px solid #f9e2c4; padding-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .cap-text { font-size: 19px; line-height: 1.8; color: #4a4a4a; }

        @media print { .tab-menu, .btn { display: none !important; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h1>ğŸŒ¿ ãƒªãƒˆãƒªãƒ¼ãƒˆå…¥å£ãƒŠãƒ“</h1></div>
    
    <div class="no-box">
        <strong style="color: #e67e22; font-size: 1rem; display: block; margin-bottom: 8px;">ğŸ›¡ï¸ å®‰å¿ƒã—ã¦ãŠä½¿ã„ã„ãŸã ããŸã‚ã«</strong>
        <div style="display: flex; justify-content: space-around; font-size: 0.75rem;">
            <span>âŒ è¨ºæ–­ã˜ã‚ƒãªã„</span><span>âŒ æ–­å®šã—ãªã„</span><span>âŒ ç”³ã—è¾¼ã¿ã‚’è¿«ã‚‰ãªã„</span>
        </div>
    </div>

    <div class="intro-box">
        ğŸ•Šï¸ <strong>ã“ã®ãƒ„ãƒ¼ãƒ«ã®ç›®çš„</strong><br>
        å¿™ã—ã„æ—¥ã€…ã®ä¸­ã§ã€ã€Œä»Šã®è‡ªåˆ†ã¯ã©ã“ã«ç«‹ã£ã¦ã„ã‚‹ã‹ã€ã‚’ãã£ã¨ç¢ºã‹ã‚ã‚‹ãŸã‚ã®<strong>æ•´ç†ãƒŠãƒ“</strong>ã§ã™ã€‚çµæœã¯ç­”ãˆã§ã¯ãªãã€æ°—ã¥ãã®ãã£ã‹ã‘ã¨ã—ã¦ãŠä½¿ã„ãã ã•ã„ã€‚<br><br>
        ğŸ“Œ <strong>æ‰€è¦æ™‚é–“ã®ç›®å®‰ï¼š1åˆ†</strong><br>
        ã©ã‚Œã‹ä¸€ã¤ã§ã‚‚ã€Œè¿‘ã„ã€ã¨æ„Ÿã˜ãŸã‚‰ã€ãã‚Œã ã‘ã§ååˆ†ã§ã™ã€‚ç„¡ç†ã«å½“ã¦ã¯ã‚ãªãã¦å¤§ä¸ˆå¤«ã§ã™ã€‚
    </div>

    <div class="tab-menu" id="top-tabs">
        <button class="tab-btn active" data-tab="mi">ğŸŒ¿ä»Šã®ã‚ãªãŸ</button>
        <button class="tab-btn" data-tab="total" id="total-btn" disabled>ğŸ“Š å¤§åˆ‡ãªã‚ãªãŸã¸</button>
    </div>

    <div id="mi" class="tab-content active">
        <div id="mi-q"></div>
        <button class="btn" style="background:var(--mi-color)" onclick="calcMI()">ä»Šã®ã‚ãŸã—ã‚’è¨€è‘‰ã«ã™ã‚‹ ğŸ”</button>
        <div id="mi-res" class="res-area" style="border-color:var(--mi-color)"></div>
    </div>

    <div id="total" class="tab-content">
        <div id="total-content"></div>
        <button class="btn" style="background:var(--to-color)" onclick="saveAsImage()">ğŸ“¸ ç”»åƒã§ä¿å­˜ã™ã‚‹</button>
    </div>

    <!-- å…¬å¼LINEå°ç·šï¼ˆæœ€ä¸‹éƒ¨ï¼‰ -->
    <div style="margin-top: 40px; border-top: 1px solid #eee; padding-top: 20px;">
        <button class="btn" style="background:var(--to-color)" onclick="openTotal()">
            ğŸ’Œ å¤§åˆ‡ãªã‚ãªãŸã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        </button>

        <div style="font-size:0.8rem; color:#888; text-align:center; margin-top:10px;">
            â€»ã“ã®çµæœã¯ç”³ã—è¾¼ã¿åˆ¤å®šã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å¿…è¦ãŒãªã‘ã‚Œã°ä½•ã‚‚ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
        </div>

        <!-- TODO: ä¸‹ã®URLã‚’ã‚ãªãŸã®ã€Œå…¬å¼LINEã€ã®URLã«ç½®ãæ›ãˆã¦ãã ã•ã„ -->
        <a class="btn" style="background:#06C755;" href="https://line.me/R/ti/p/@YOUR_LINE_ID" target="_blank" rel="noopener">
            ğŸ’¬ å…¬å¼LINEã§ç„¡æ–™ç›¸è«‡ã™ã‚‹
        </a>
        <div style="font-size:0.8rem; color:#888; text-align:center; margin-top:10px;">
            â€»ã€Œç„¡æ–™ç›¸è«‡ã™ã‚‹ã€ã¯ä½•ã‹ã‚’å£²ã£ãŸã‚Šã—ã¾ã›ã‚“ã€‚ä»Šã®çŠ¶æ…‹ã‚’ä¸€ç·’ã«æ•´ç†ã™ã‚‹ãŸã‚ã®ãã£ã‹ã‘ã§ã™ã€‚
        </div>
    </div>
</div>

<div id="capture-container">
    <div class="cap-box" style="background:#fffcf5;">
        <div class="cap-title">ğŸ¤ ã„ã¾ã®è‡ªåˆ†ã¸ã®ãƒ¡ãƒ¢</div>
        <div id="cap-summary" class="cap-text"></div>
    </div>
    <div class="cap-row">
        <div class="cap-col">
            <div class="cap-box" style="background:#fff5f5; border-color:#ff7f7f; height: 100%;">
                <div class="cap-title" style="color:#ff7f7f;">ã‚ãªãŸã¯ãã£ã¨ã“ã‚“ãªçŠ¶æ…‹</div>
                <div id="cap-translation" class="cap-text"></div>
            </div>
        </div>
        <div class="cap-col">
            <div class="cap-box" style="background:#f0f7ff; border-color:#4db8ff; height: 100%;">
                <div class="cap-title" style="color:#4db8ff;">ğŸ’Œ å¤§åˆ‡ãªã‚ãªãŸã¸</div>
                <div id="cap-message" class="cap-text"></div>
            </div>
        </div>
    </div>
</div>

<script>
// --- ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆãƒªãƒˆãƒªãƒ¼ãƒˆç‰ˆ ver.1ï¼šå…¥å£7å•ï¼‰ ---
// reverse:true ã®è¨­å•ã¯ã€Œè¿‘ã„ã€ã»ã©ã‚¹ã‚³ã‚¢ãŒä¸‹ãŒã‚‹ï¼ˆé€†è»¢é …ç›®ï¼‰
const miData = [
    {c:"å…¥å£", q:"ä½•ã‹ã‚’æ±ºã‚ã‚‹ã¨ãã€ã€Œè€ƒãˆã¦ã„ã‚‹ã®ã«é€²ã¾ãªã„ã€æ„Ÿã˜ãŒã‚ã‚‹"},
    {c:"å…¥å£", q:"ä¼‘ã‚“ã§ã„ã‚‹ã¯ãšãªã®ã«ã€å›å¾©ã—ãŸå®Ÿæ„ŸãŒã‚ã¾ã‚Šãªã„"},
    {c:"å…¥å£", q:"èª°ã‹ã«å¼±éŸ³ã‚’åãã‚ˆã‚Šã€è‡ªåˆ†ã§ãªã‚“ã¨ã‹ã—ã‚ˆã†ã¨ã™ã‚‹ã“ã¨ãŒå¤šã„"},
    {c:"å…¥å£", q:"æœ€è¿‘ã€ã€Œã“ã®ã¾ã¾ã§ã„ã„ã®ã‹ãªã€ãŒãµã¨æµ®ã‹ã¶"},
    {c:"å…¥å£", q:"é ‘å¼µã£ã¦ã„ã‚‹è‡ªè¦šã¯ã‚ã‚‹ãŒã€ãã‚Œã‚’ã¡ã‚ƒã‚“ã¨åŠ´ãˆã¦ã„ãªã„æ°—ãŒã™ã‚‹"},
    {c:"å…¥å£", q:"æœ€è¿‘ã€è‡ªç„¶ã«å‘¼å¸ãŒæ·±ããªã‚‹ç¬é–“ï¼ˆå®‰å¿ƒãƒ»è½ã¡ç€ãï¼‰ãŒã‚ã£ãŸ", reverse:true},
    {c:"å…¥å£", q:"ä¼‘ã‚€ã¨å°‘ã—å›å¾©ã™ã‚‹æ„Ÿè¦šï¼ˆçœ ã‚‹ãƒ»æ•£æ­©ãƒ»æ¹¯èˆ¹ãªã©ï¼‰ãŒæ®‹ã£ã¦ã„ã‚‹", reverse:true}
];

// --- ãƒ­ã‚¸ãƒƒã‚¯éƒ¨åˆ† ---
function autoScroll(el) { 
    const b = el.closest('.q-block').nextElementSibling; 
    if (b && b.classList.contains('q-block')) setTimeout(() => b.scrollIntoView({ behavior: 'smooth', block: 'center' }), 300); 
}
function create5Scale(name) { 
    return `<div class="radio-group">${['ã¨ã¦ã‚‚<br>è¿‘ã„','å°‘ã—<br>è¿‘ã„','ã©ã¡ã‚‰<br>ã¨ã‚‚','ã‚ã¾ã‚Š<br>ãªã„','ãªã„'].map((l,i)=>`<label class="radio-label"><input type="radio" name="${name}" value="${4-i}" onclick="autoScroll(this)">${l}</label>`).join('')}</div>`; 
}

function setup() {
    const target = document.getElementById('mi-q');
    target.innerHTML = '';
    miData.forEach((d,i)=> {
        target.innerHTML += `<div class="q-block"><span class="q-text">${i+1}. ${d.q}</span>${create5Scale('mi'+i)}</div>`;
    });
}
setup();

let results = { mi:null };

function calcMI() {
    let total = 0;

    miData.forEach((d,i) => {
        const v = parseInt(document.querySelector(`input[name="mi${i}"]:checked`)?.value || 0);
        total += d.reverse ? (4 - v) : v;
    });

    // 0ã€œ28ç‚¹ï¼ˆ7å•Ã—0ã€œ4 / é€†è»¢å«ã‚€ï¼‰
    let title = "";
    let body = "";
    let next = "";

    // ã€Œ1é€±é–“ã®å°ã•ãªç¿’æ…£ã€ææ¡ˆï¼ˆå…±é€šã®å‹ã¨ã—ã¦ä½¿ã†ï¼‰
    const weekHabits =
        "ã€1é€±é–“ã®å°ã•ãªç¿’æ…£ï¼ˆã§ãã‚‹ã‚‚ã®ã‚’1ã¤ã§OKï¼‰ã€‘<br>" +
        "â‘  1æ—¥1å›ã€æ·±å‘¼å¸ã‚’3å›ï¼ˆè‚©ã®åŠ›ã‚’æŠœãï¼‰<br>" +
        "â‘¡ å¤œã€ã‚¹ãƒãƒ›ã‚’ç½®ã„ã¦â€œ1åˆ†ã ã‘â€ç›®ã‚’é–‰ã˜ã‚‹<br>" +
        "â‘¢ æ¹¯èˆ¹ or ã¬ã‚‹ã‚ã®ã‚·ãƒ£ãƒ¯ãƒ¼ã§ã€Œæ¸©ã‚ã‚‹ã€<br>" +
        "â‘£ æ•£æ­©1åˆ†ã§ã‚‚OKï¼ˆå¤–ã®ç©ºæ°—ã‚’å¸ã†ï¼‰<br>" +
        "â‘¤ ã€ä»Šæ—¥ã§ããŸã“ã¨ã€ã‚’1è¡Œãƒ¡ãƒ¢ï¼ˆå°ã•ãã¦OKï¼‰";

    if (total <= 9) {
        title = "ä»Šã®ã¾ã¾ã§å¤§ä¸ˆå¤«ã€‚è‡ªåˆ†ã‚’å¤§åˆ‡ã«ã§ãã¦ã„ã¾ã™";
        body =
            "ä»Šã®ã‚ãªãŸã¯ã€å¤§ããå´©ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚<br>" +
            "ã€Œæ•´ãˆã‚‹ã€ã“ã¨ã¯ã€ç‰¹åˆ¥ãªä½•ã‹ã‚’è¶³ã™ã“ã¨ã ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>" +
            "ã™ã§ã«ã‚ãªãŸã¯ã€æ—¥å¸¸ã®ä¸­ã§å›å¾©ã®èŠ½ã‚’è‚²ã¦ã¦ã„ã¾ã™ã€‚ç´ æ•µã§ã™ã€‚";
        next =
            weekHabits + "<br><br>" +
            "ã‚‚ã—ã€Œã‚‚ã†å°‘ã—è‡ªåˆ†ã§æ•´ãˆã‚‹æ–¹æ³•ã€ã‚’å…·ä½“çš„ã«çŸ¥ã‚ŠãŸã„å ´åˆã¯ã€ä¸‹ã®ã€Œè‡ªåˆ†ã§æ•´ãˆã‚‹ï¼ˆPDFï¼‰ã€ã‚’ã©ã†ãã€‚å¿…è¦ãŒãªã‘ã‚Œã°ã€ã“ã“ã§çµ‚ã‚ã£ã¦OKã§ã™ã€‚";
    } else if (total <= 18) {
        title = "å°‘ã—ç«‹ã¡æ­¢ã¾ã‚ŠãŸã„ã‚µã‚¤ãƒ³ãŒå‡ºã¦ã„ã‚‹çŠ¶æ…‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“";
        body =
            "å‰ã«é€²ã‚€åŠ›ã¯ã‚ã‚‹ã‘ã‚Œã©ã€å°‘ã—ãƒšãƒ¼ã‚¹ã‚’ç·©ã‚ãŸã»ã†ãŒé¸æŠãŒã—ã‚„ã™ããªã‚‹æ™‚æœŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚<br>" +
            "ã“ã‚Œã¯å¼±ã•ã§ã¯ãªãã€<strong>èª¿æ•´ãŒå¿…è¦ã«ãªã£ãŸã‚µã‚¤ãƒ³</strong>ã§ã™ã€‚";
        next =
            weekHabits + "<br><br>" +
            "ä»Šã¯ã€Œæ°—åˆã„ã§ä¹—ã‚Šåˆ‡ã‚‹ã€ã‚ˆã‚Šã€<strong>æ•´ã„ã‚„ã™ã„å½¢ã«å¤‰ãˆã‚‹</strong>ã»ã†ãŒå›å¾©ãŒæ—©ã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚";
    } else {
        title = "æ„Ÿè¦šã‚’å–ã‚Šæˆ»ã™ä½™ç™½ãŒå¿…è¦ãªçŠ¶æ…‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“";
        body =
            "é ­ã§ã¯è€ƒãˆã¦ã„ã‚‹ã®ã«ã€æ„Ÿè¦šã®å£°ãŒå°‘ã—é ããªã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚<br>" +
            "æƒ…å ±ã‚’å¢—ã‚„ã™ã‚ˆã‚Šã€<strong>ç’°å¢ƒã‚’å¤‰ãˆã‚‹</strong>ã“ã¨ã§æ°—ã¥ããŒæˆ»ã‚Šã‚„ã™ã„çŠ¶æ…‹ã§ã™ã€‚";
        next =
            weekHabits + "<br><br>" +
            "ã€Œã¾ã å¤§ä¸ˆå¤«ã€ã¨è¨€ã„ç¶šã‘ã‚‰ã‚Œã‚‹äººã»ã©ã€ç«‹ã¡æ­¢ã¾ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’é€ƒã—ã‚„ã™ã„ã§ã™ã€‚<strong>ä»Šã®ã†ã¡ã«æ•´ãˆã‚‹</strong>ã¨å°‘ã—ãƒ©ã‚¯ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚";
    }

    results.mi = { total, title, body, next };

    document.getElementById('mi-res').innerHTML =
        `<h3>ğŸŒ¿ ä»Šã®ã‚ãªãŸï¼š${title}</h3>` +
        `<div class="analysis-card">` +
        `<span class="analysis-label">ã€ã„ã¾ã®çŠ¶æ…‹ã€‘</span>` +
        `<span class="analysis-text">${body}</span>` +
        `<span class="analysis-label">ã€æ¬¡ã®ä¸€æ‰‹ã®ãƒ’ãƒ³ãƒˆã€‘</span>` +
        `<span class="analysis-text">${next}</span>` +
        `</div>`;

    document.getElementById('mi-res').style.display = 'block';
    checkReady();
}

function checkReady() { 
    if(results.mi) {
        document.querySelectorAll('button[data-tab="total"]').forEach(b => b.disabled = false);
    }
}

function generateTotalDiagnosis() {
    if (!results.mi) return;

    const maxScore = 28;

    const summaryHtml = `
        <div style="margin-bottom:20px; border-left:8px solid var(--mi-color); padding-left:15px;">
            <strong style="font-size:1.2rem;">ã„ã¾ã®çŠ¶æ…‹ï¼š${results.mi.title}</strong><br>
            <span style="font-size:0.95rem;">ã‚¹ã‚³ã‚¢ç›®å®‰ï¼š${results.mi.total} / ${maxScore}ï¼ˆâ€»ç­”ãˆã§ã¯ãªãã€ä»Šã®ä½ç½®ã®ãƒ¡ãƒ¢ã§ã™ï¼‰</span>
        </div>`;

    const translationHtml =
        `ã“ã®çµæœã¯ã€Œå½“ã¦ã‚‹ã€ãŸã‚ã®ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>` +
        `ã‚ãªãŸã®ä¸­ã«ã‚ã‚‹<strong>èª¿æ•´ã®ã‚µã‚¤ãƒ³</strong>ã‚’ã€ã„ã¾ã®è¨€è‘‰ã«ç½®ãæ›ãˆãŸã‚‚ã®ã§ã™ã€‚<br><br>` +
        `<strong>ã„ã¾ã®çŠ¶æ…‹</strong>ï¼š${results.mi.body}<br><br>` +
        `<strong>æ¬¡ã®ä¸€æ‰‹ã®ãƒ’ãƒ³ãƒˆ</strong>ï¼š${results.mi.next}`;

    const messageHtml =
        `ã“ã“ã¾ã§ãŸã©ã‚Šç€ã„ãŸæ™‚ç‚¹ã§ã€ã‚ãªãŸã¯ã‚‚ã†ååˆ†ã«è‡ªåˆ†ã‚’å¤§åˆ‡ã«ã—å§‹ã‚ã¦ã„ã¾ã™ã€‚<br>` +
        `ç«‹ã¡æ­¢ã¾ã‚‹ã“ã¨ã¯ã€é€ƒã’ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>` +
        `ã€Œã¾ã é¸ã¹ã‚‹ã†ã¡ã«æ•´ãˆã‚‹ã€ã“ã¨ã¯ã€æœªæ¥ã®è‡ªåˆ†ã¸ã®è´ˆã‚Šç‰©ã§ã™ã€‚<br><br>` +
        `å¿…è¦ãªã‚‰ã€ã‚ãªãŸã®ãƒšãƒ¼ã‚¹ã§é¸ã‚“ã§ãã ã•ã„ã€‚`;

    document.getElementById('total-content').innerHTML = `
        <div class="analysis-card">${summaryHtml}</div>

        <div style="font-size:0.85rem; color:#888; text-align:center; margin: 10px 0 15px;">
            â€»ã“ã®çµæœã¯ç”³ã—è¾¼ã¿åˆ¤å®šã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å¿…è¦ãŒãªã‘ã‚Œã°ä½•ã‚‚ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
        </div>

        <div style="background: #fff5f5; border: 2px solid #ff7f7f; padding: 25px; border-radius: 25px; margin: 25px 0;">
            <strong style="color:#ff7f7f; font-size:1.2rem;">å¤§åˆ‡ãªã‚ãªãŸã¸</strong><br><br><div style="line-height:1.8;">${translationHtml}</div>
        </div>

        <div style="background: #f0f7ff; padding: 30px; border-radius: 30px; margin-top: 35px; border: 1px solid #e0f0ff;">
            <strong style="color:#4db8ff; font-size:1.2rem;">ğŸ’Œ ã‚ãªãŸã¸</strong><br><br><div style="line-height:1.8;">${messageHtml}</div>
        </div>

        <div style="margin-top: 20px;">
            <!-- TODO: ä¸‹ã®URLã‚’è¬›å¸«ãŒä½œã£ãŸã€Œè‡ªåˆ†ã§æ•´ãˆã‚‹æ–¹æ³•ï¼ˆPDFï¼‰ã€ã®URLã«ç½®ãæ›ãˆã¦ãã ã•ã„ -->
            <a class="btn" style="background:#FF9F43;" href="https://example.com/your-selfcare.pdf" target="_blank" rel="noopener">
                ğŸ“˜ è‡ªåˆ†ã§æ•´ãˆã‚‹ï¼ˆPDFï¼‰
            </a>

            <!-- TODO: ä¸‹ã®URLã‚’ã‚ãªãŸã®ã€Œå…¬å¼LINEã€ã®URLã«ç½®ãæ›ãˆã¦ãã ã•ã„ -->
            <a class="btn" style="background:#06C755;" href="https://line.me/R/ti/p/@YOUR_LINE_ID" target="_blank" rel="noopener">
                ğŸ’¬ èª°ã‹ã«è©±ã—ã¦æ•´ç†ã™ã‚‹ï¼ˆå…¬å¼LINEã§ç„¡æ–™ç›¸è«‡ï¼‰
            </a>

            <!-- TODO: ä¸‹ã®URLã‚’ã€Œãƒªãƒˆãƒªãƒ¼ãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ã€ã®URLã«ç½®ãæ›ãˆã¦ãã ã•ã„ -->
            <a class="btn" style="background:#5D5FEF;" href="https://example.com/retreat-detail" target="_blank" rel="noopener">
                ğŸŒ¿ ç’°å¢ƒã‹ã‚‰é›¢ã‚Œã¦æ•´ãˆã‚‹ï¼ˆãƒªãƒˆãƒªãƒ¼ãƒˆè©³ç´°ã¸ï¼‰
            </a>
        </div>
    `;

    document.getElementById('cap-summary').innerHTML = summaryHtml;
    document.getElementById('cap-translation').innerHTML = translationHtml;
    document.getElementById('cap-message').innerHTML = messageHtml;
}

function saveAsImage() {
    const area = document.getElementById('capture-container');
    html2canvas(area, { scale: 2, backgroundColor: "#fcf9f5", windowWidth: 1200 }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'ãƒªãƒˆãƒªãƒ¼ãƒˆå…¥å£ãƒ¡ãƒ¢.png';
        link.href = canvas.toDataURL();
        link.click();
    });
}

function openTotal() {
    // çµæœãŒæœªè¨ˆç®—ãªã‚‰ã€è¨ˆç®—ã‚’ä¿ƒã™ï¼ˆã“ã“ã§ã¯ã‚¿ãƒ–ç§»å‹•ã®ã¿ï¼‰
    if (!results.mi) {
        // æœªè¨ˆç®—ã®ã¾ã¾ã§ã‚‚ã‚¿ãƒ–è¡¨ç¤ºã¯å¯èƒ½ã ãŒã€ä¸­èº«ãŒãªã„ã®ã§å…ˆã«è¨ˆç®—ã‚’ä¿ƒã™ãŸã‚miã¸æˆ»ã™
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll(`.tab-btn[data-tab="mi"]`).forEach(b => b.classList.add('active'));
        document.getElementById('mi').classList.add('active');
        window.scrollTo({top: 0, behavior: 'smooth'});
        return;
    }

    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.querySelectorAll(`.tab-btn[data-tab="total"]`).forEach(b => b.classList.add('active'));
    document.getElementById('total').classList.add('active');
    generateTotalDiagnosis();
    window.scrollTo({top: 0, behavior: 'smooth'});
}

document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        const targetTab = btn.dataset.tab;

        // disabledãƒœã‚¿ãƒ³ã¯ä½•ã‚‚ã—ãªã„
        if (btn.disabled) return;

        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll(`.tab-btn[data-tab="${targetTab}"]`).forEach(b => b.classList.add('active'));
        document.getElementById(targetTab).classList.add('active');

        if(targetTab === 'total') generateTotalDiagnosis();
        window.scrollTo({top: 0, behavior: 'smooth'});
    });
});
</script>
</body>
</html>
